{% extends "base.html" %}
{% block title %}Shadowserver â€” Data Explorer{% endblock %}

{% block nav_extra %}
<a href="/" class="btn btn-sm btn-outline-secondary">All Cases</a>
{% endblock %}

{% block content %}
<!-- Summary cards -->
<div class="row g-3 mb-3">
    <div class="col-md-3">
        <div class="card">
            <div class="card-body text-center">
                <div class="text-muted small">Total Events</div>
                <div class="fs-4 fw-bold" id="stat-total">-</div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body text-center">
                <div class="text-muted small">Report Types</div>
                <div class="fs-4 fw-bold" id="stat-types">-</div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body text-center">
                <div class="text-muted small">Date Range</div>
                <div class="fs-6 fw-bold" id="stat-range">-</div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body text-center">
                <div class="text-muted small">Last Ingestion</div>
                <div class="fs-6 fw-bold" id="stat-last-run">-</div>
            </div>
        </div>
    </div>
</div>

<!-- Filter bar -->
<div class="card mb-3">
    <div class="card-body py-2">
        <form id="ss-filters" class="row g-2 align-items-end">
            <div class="col-md-3">
                <label class="form-label small mb-0">Report Type</label>
                <select id="filter-type" class="form-select form-select-sm">
                    <option value="">All types</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label small mb-0">Date From</label>
                <input type="date" id="filter-from" class="form-control form-control-sm">
            </div>
            <div class="col-md-2">
                <label class="form-label small mb-0">Date To</label>
                <input type="date" id="filter-to" class="form-control form-control-sm">
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-sm btn-primary me-1">Apply</button>
                <button type="button" id="btn-reset" class="btn btn-sm btn-outline-secondary">Reset</button>
            </div>
        </form>
    </div>
</div>

<!-- Events DataTable -->
<table id="ss-table" class="table table-striped table-sm w-100">
    <thead>
        <tr>
            <th>Date</th>
            <th>Type</th>
            <th>IP</th>
            <th>Port</th>
            <th>ASN</th>
            <th>Country</th>
            <th>Hostname</th>
            <th>Tag</th>
            <th>Severity</th>
            <th>Details</th>
        </tr>
    </thead>
</table>

<!-- Ingestion status panel -->
<div class="card mt-3">
    <div class="card-header py-2">
        <strong>Recent Ingestion Runs</strong>
    </div>
    <div class="card-body p-0">
        <table class="table table-sm table-striped mb-0" id="ingestion-log">
            <thead>
                <tr>
                    <th>Started</th>
                    <th>Finished</th>
                    <th>Status</th>
                    <th>Reports</th>
                    <th>Inserted</th>
                    <th>Skipped</th>
                    <th>Error</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/shadowserver.js') }}"></script>
{% endblock %}
