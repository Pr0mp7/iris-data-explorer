# IRIS Data Explorer Configuration
# Copy this file to .env and fill in your values

# ── IRIS Connection (Required) ──────────────────────────────────
IRIS_URL=https://your-iris-instance:4443
IRIS_VERIFY_SSL=false               # Set to true if IRIS has valid TLS cert

# ── Browser-Facing IRIS URL (for deep links) ───────────────────
# If IRIS_URL is an internal Docker hostname (e.g. https://iriswebapp_nginx:4443),
# set this to the URL users access IRIS from in their browser.
# Defaults to IRIS_URL if not set.
# IRIS_EXTERNAL_URL=https://10.10.190.104:4443

# ── Authentication Mode ─────────────────────────────────────────
# Option A: Pass-through (recommended) — leave IRIS_API_KEY empty.
#   Users log in with their own IRIS API key. Permissions match IRIS.
#
# Option B: Service mode — set IRIS_API_KEY to a shared key.
#   All users share the same permissions. No login page shown.
IRIS_API_KEY=

# ── Flask Secret Key ────────────────────────────────────────────
# Used to sign session cookies. Auto-generated if not set,
# but sessions won't survive container restarts without a fixed key.
# Generate one: python3 -c "import secrets; print(secrets.token_hex(32))"
SECRET_KEY=

# ── Session Cookie Security ─────────────────────────────────────
# Set to true if running behind HTTPS (recommended in production)
# SESSION_COOKIE_SECURE=true

# ── Data Source ─────────────────────────────────────────────────
DATA_SOURCE=api                      # "api" (default) or "db" for direct PostgreSQL

# ── Explorer Port ───────────────────────────────────────────────
EXPLORER_PORT=8087                   # Host port mapping

# ── Cache TTL ───────────────────────────────────────────────────
CACHE_TTL=300                        # Seconds to cache fetched data (default: 300)

# ── Database Mode (only needed if DATA_SOURCE=db) ──────────────
# Create a read-only user first:
#   CREATE USER explorer_viewer WITH PASSWORD 'secure';
#   GRANT CONNECT ON DATABASE iris_db TO explorer_viewer;
#   GRANT USAGE ON SCHEMA public TO explorer_viewer;
#   GRANT SELECT ON ALL TABLES IN SCHEMA public TO explorer_viewer;
#
# DB_HOST=iriswebapp_db
# DB_PORT=5432
# DB_NAME=iris_db
# DB_USER=explorer_viewer
# DB_PASSWORD=changeme
# DB_SSL_MODE=prefer                 # prefer, require, verify-ca, verify-full

# ── Keycloak SSO (optional) ────────────────────────────────────
# Enable "Login with Keycloak" button on the login page.
# Users authenticate via Keycloak; their IRIS API key is read from
# the Keycloak user attribute "iris_api_key" (passed via OIDC claim).
# KEYCLOAK_ENABLED=true
# KEYCLOAK_SERVER_URL=http://10.10.190.104:8081
# KEYCLOAK_REALM=sva-lab
# KEYCLOAK_CLIENT_ID=iris-data-explorer
# KEYCLOAK_CLIENT_SECRET=changeme

# ── Shadowserver Integration (optional) ──────────────────────────
# Enable the Shadowserver tab in the UI.
# Requires a separate shadowserver-ingestor container writing to shadowserver_db.
# SS_ENABLED=true
# SS_DB_HOST=postgres
# SS_DB_PORT=5432
# SS_DB_NAME=shadowserver_db
# SS_DB_USER=shadowserver_viewer
# SS_DB_PASSWORD=changeme
# SS_DB_SSL_MODE=prefer              # prefer, require, verify-ca, verify-full
